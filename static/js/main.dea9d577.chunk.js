(this["webpackJsonpshopping-list"]=this["webpackJsonpshopping-list"]||[]).push([[0],{26:function(e,t,n){},27:function(e,t,n){},28:function(e,t,n){},30:function(e,t,n){},31:function(e,t,n){},32:function(e,t,n){},41:function(e,t,n){"use strict";n.r(t);var s=n(1),a=n.n(s),i=n(20),r=n.n(i),c=(n(26),n(8)),o=n(4),d=n(12),l=n(2),u=(n(27),new Set(["Kg","gm","Packet(s)","No"])),m=n(14),b=n(15),v=function(){function e(t){Object(m.a)(this,e),this.db=void 0,this.listeners=new Set,this.db=t,this.invokeListeners=this.invokeListeners.bind(this)}return Object(b.a)(e,[{key:"setDB",value:function(e){this.db=e}},{key:"hasDB",value:function(){return!!this.db}},{key:"invokeListeners",value:function(e){this.listeners.forEach((function(t){t(e)}))}},{key:"fetch",value:function(){this.db&&this.db.getAllItems().then(this.invokeListeners)}},{key:"addListener",value:function(e){this.listeners.add(e)}},{key:"removeListener",value:function(e){this.listeners.delete(e)}},{key:"addUpdate",value:function(e){this.db&&this.db.addUpdateItem(e)}},{key:"delete",value:function(e){this.db&&this.db.deleteItem(e)}},{key:"clearUnsaved",value:function(){if(this.db)return this.db.clearUnsaved()}},{key:"saveUnsaved",value:function(e){if(this.db)return this.db.saveUnsaved(e)}}]),e}(),f=a.a.createContext({}),j=f.Provider,h=(n(28),n(0));function g(e){var t=Object(s.useContext)(f),n=e.newItemStatesAndSetters,a=n.name,i=n.setName,r=n.quantity,o=n.setQuantity,d=n.unit,l=n.setUnit,m=n.comment,b=n.setComment,v=n.existing,j=n.setExisting,g=n.date,p=[];return e.masterList.forEach((function(t){e.newList.find((function(e){return e.name===t}))||p.push(t)})),Object(h.jsxs)("form",{id:"item-controls",children:[Object(h.jsxs)("div",{className:"mb-3",children:[Object(h.jsx)("label",{htmlFor:"item-search",className:"form-label",children:"Item name"}),Object(h.jsx)("input",{type:"search",id:"item-search",className:"form-control bottom-border-only",list:"next-item-list","aria-label":"Search through master list",onChange:function(t){i(t.currentTarget.value);var n=e.masterItems.find((function(e){return e.name===t.currentTarget.value}));n&&(o(n.quantity),l(n.unit),l(n.unit),b(n.comment)),j(-1!==e.newList.findIndex((function(e){return e.name===t.currentTarget.value})))},value:a,required:!0})]}),Object(h.jsx)("datalist",{id:"next-item-list",children:p.map((function(e){return Object(h.jsx)("option",{value:e},e)}))}),Object(h.jsxs)("div",{className:"mb-3",children:[Object(h.jsx)("label",{htmlFor:"qty-input",className:"form-label",children:"Quantity"}),Object(h.jsx)("input",{type:"number",className:"form-control bottom-border-only",id:"qty-input","aria-label":"Quantity",min:1,required:!0,onChange:function(e){""!==e.currentTarget.value?o(parseInt(e.currentTarget.value)):o(0)},value:0===r?"":r+""})]}),Object(h.jsxs)("div",{className:"mb-3",children:[Object(h.jsx)("label",{htmlFor:"unit-input",className:"form-label",children:"Unit"}),Object(h.jsx)("input",{type:"text",className:"form-control bottom-border-only",id:"unit-input",list:"unit-list","aria-label":"Unit",required:!0,onChange:function(e){l(e.currentTarget.value)},value:d})]}),Object(h.jsx)("datalist",{id:"unit-list",children:Object(c.a)(u).map((function(e){return Object(h.jsx)("option",{value:e},e)}))}),Object(h.jsxs)("div",{className:"mb-3",children:[Object(h.jsx)("label",{htmlFor:"comments-input",className:"form-label",children:"Comments"}),Object(h.jsx)("input",{type:"text",className:"form-control bottom-border-only",id:"comments-input","aria-label":"Comments",onChange:function(e){b(e.currentTarget.value)},value:m})]}),Object(h.jsx)("br",{}),Object(h.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"},children:[Object(h.jsx)("input",{type:"submit",value:v?"Modify":"Add",className:"btn btn-primary",onClick:function(n){n.preventDefault(),a&&r&&d&&(t.addUpdate({name:a,quantity:r,unit:d,comment:m,saved:0,date:g}),e.setNewList((function(e){var t=e.findIndex((function(e){return e.name===a}));if(-1===t)return[].concat(Object(c.a)(e),[{name:a,quantity:r,unit:d,comment:m,saved:0,date:g}]);var n=Object(c.a)(e),s=n[t];return s.quantity=r,s.unit=d,s.comment=m,n})),e.setMasterList((function(e){if(e.has(a))return e;var t=new Set(e);return t.add(a),t})),i(""),o(0),l(""),b(""),j(!1))},style:{flexGrow:.4}}),Object(h.jsx)("input",{type:"button",value:"Clear",className:"btn btn-danger",onClick:function(){i(""),o(0),l(""),b(""),j(!1)},style:{flexGrow:.4}})]})]})}function p(e){var t=!!e.newItemStatesAndSetters&&e.newItemStatesAndSetters.name===e.item.name;return Object(h.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-start"+(t?" active":""),children:[Object(h.jsxs)("div",{className:"ms-2 me-auto",style:{width:"100vw"},onClick:function(){e.newItemStatesAndSetters&&(e.newItemStatesAndSetters.setName(e.item.name),e.newItemStatesAndSetters.setQuantity(e.item.quantity),e.newItemStatesAndSetters.setUnit(e.item.unit),e.newItemStatesAndSetters.setComment(e.item.comment),e.newItemStatesAndSetters.setExisting(!0))},children:[Object(h.jsx)("div",{className:"fw-bold",style:{display:"inline"},children:e.item.name+(e.item.comment?" ("+e.item.comment+")":"")}),Object(h.jsxs)("div",{children:[e.item.quantity,"\xa0",e.item.unit]})]}),e.removeItem&&Object(h.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(){e.removeItem&&e.removeItem(e.item)}})]})}n(30);var O=function(e){var t=["".concat(e[0].date.toLocaleDateString()),"".concat(e.length," items"),""];return e.forEach((function(e,n){var s=e.comment?" (".concat(e.comment,")"):"";t.push("".concat(n+1,". ").concat(e.name).concat(s," : ").concat(e.quantity," ").concat(e.unit))})),t.join("\n")};function x(e){var t=Object(s.useState)(!1),n=Object(o.a)(t,2),a=n[0],i=n[1];return Object(h.jsxs)("div",{children:[Object(h.jsx)("ol",{className:"list-group list-group-numbered",style:{maxHeight:"80vh",overflowY:"auto"},children:e.list.map((function(t){return Object(h.jsx)(p,{item:t,newItemStatesAndSetters:e.newItemStatesAndSetters,removeItem:e.removeItem},t.name)}))}),Object(h.jsx)("br",{}),e.copyList&&e.list.length>0&&Object(h.jsx)("input",{type:"button",value:a?"Copied!":"Copy list",className:"btn "+(a?"btn-success":"btn-primary"),onClick:function(){navigator.clipboard.writeText(O(e.list)).then((function(){i(!0),setTimeout((function(){i(!1)}),1e3)}))}})]})}function w(e){var t=Object(s.useContext)(f),n=function(){e.newItemStatesAndSetters.setName(""),e.newItemStatesAndSetters.setQuantity(0),e.newItemStatesAndSetters.setUnit(""),e.newItemStatesAndSetters.setComment(""),e.newItemStatesAndSetters.setExisting(!1)};return Object(h.jsxs)("div",{id:"new-item-list-wrapper",children:[Object(h.jsxs)("p",{children:["Shopping list(",e.list.length,")"]}),Object(h.jsx)(x,{list:e.list,newItemStatesAndSetters:e.newItemStatesAndSetters,removeItem:e.removeItem}),Object(h.jsxs)("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",marginTop:10},children:[Object(h.jsx)("input",{type:"button",value:"Save and Copy",className:"btn btn-primary",onClick:function(){var s;if(0!==e.list.length){var a=new Date;null===(s=t.saveUnsaved(a))||void 0===s||s.then((function(){n(),e.setRunFetchEffect(!0)})),navigator.clipboard.writeText(O(e.list))}},style:{flexGrow:.4},disabled:0===e.list.length}),Object(h.jsx)("input",{type:"button",value:"Clear",className:"btn btn-danger",onClick:function(){var s;0!==e.list.length&&(null===(s=t.clearUnsaved())||void 0===s||s.then((function(){n(),e.setRunFetchEffect(!0)})))},style:{flexGrow:.4},disabled:0===e.list.length})]})]})}n(31);function y(e){var t=Object(s.useContext)(f),n=e.newItemStatesAndSetters,a=n.name,i=n.setName,r=n.setQuantity,c=n.setUnit,o=n.setComment,d=n.setExisting;return Object(h.jsxs)("div",{id:"newlist-wrapper",children:[Object(h.jsx)(g,{masterList:e.masterList,setMasterList:e.setMasterList,newList:e.newList,setNewList:e.setNewList,masterItems:e.masterItems,newItemStatesAndSetters:e.newItemStatesAndSetters}),Object(h.jsx)(w,{list:e.newList,newItemStatesAndSetters:e.newItemStatesAndSetters,removeItem:function(n){var s=n.name,l=e.newList.filter((function(e){return e.name!==s}));t.delete(n),e.setNewList(l),a===s&&(i(""),r(0),c(""),o(""),d(!1))},setRunFetchEffect:e.setRunFetchEffect}),!1]})}function S(e){return Object(h.jsxs)("li",{className:"list-group-item d-flex justify-content-between align-items-start"+(e.selected?" active":""),children:[Object(h.jsxs)("div",{className:"ms-2 me-auto",style:{width:"100vw"},onClick:function(){e.setSelectedDate(e.date)},children:[Object(h.jsx)("div",{className:"fw-bold",style:{display:"inline"},children:new Date(e.date).toLocaleString()}),Object(h.jsxs)("div",{children:[e.items.length,"\xa0items"]})]}),!e.readOnly&&Object(h.jsx)("button",{type:"button",className:"btn-close","aria-label":"Close",onClick:function(){}})]})}n(32);function I(e){var t=Object(s.useState)(0),n=Object(o.a)(t,2),a=n[0],i=n[1],r=Object(c.a)(e.dateMap.keys()).sort((function(e,t){return t.valueOf()-e.valueOf()})),d=e.dateMap.get(a);return Object(h.jsxs)("div",{style:{marginLeft:10,width:"90%"},children:[Object(h.jsxs)("p",{children:["Previous shopping lists(",e.dateMap.size,")"]}),Object(h.jsxs)("div",{id:"previous-lists-wrapper",children:[Object(h.jsx)("div",{children:Object(h.jsx)("ol",{id:"previous-lists",className:"list-group list-group-numbered",children:r.map((function(t){return Object(h.jsx)(S,{date:t,items:e.dateMap.get(t)||[],selected:t===a,setSelectedDate:i,readOnly:!0},t)}))})}),Object(h.jsx)("div",{id:"previous-list-one",children:0!==a&&void 0!==d&&Object(h.jsx)(x,{list:d,copyList:!0})})]})]})}var k=function(){return Object(h.jsx)("h2",{children:"User data"})};function N(e){return{name:e.name,quantity:e.quantity,unit:e.unit,comment:e.comment,date:e.date,saved:e.saved}}var C="shopping-list-app-db",A="shopping-list-store",D=function(){function e(t){Object(m.a)(this,e),this.db=void 0,this.db=t}return Object(b.a)(e,[{key:"getAllItems",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;return new Promise((function(n,s){var a=e.db.transaction(A).objectStore(A).getAll(null,t>0?t:void 0);a.onerror=function(e){console.debug("getAllItems getAll() failed"),s(e.target?e.target.errorCode:"unknown")},a.onsuccess=function(){console.debug("getAllItems: getAll() succeeded."),n(this.result)}}))}},{key:"getItemsWithDate",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IDBKeyRange.only,s=arguments.length>2?arguments[2]:void 0;return new Promise((function(a,i){var r=(s||t.db.transaction(A)).objectStore(A).index("date").getAll(n(e));r.onerror=function(e){console.debug('getItemsWithDate .index("date").getAll() failed'),i(e.target?e.target.errorCode:"unknown")},r.onsuccess=function(){console.debug('getItemsWithDate .index("date").getAll() succeeded'),a(this.result)}}))}},{key:"getItemsSaved",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IDBKeyRange.only,s=arguments.length>2?arguments[2]:void 0;return new Promise((function(a,i){var r=(s||t.db.transaction(A)).objectStore(A).index("saved").getAll(n(e));r.onerror=function(e){console.debug('getItemsSaved .index("date").getAll() failed'),i(e.target?e.target.errorCode:"unknown")},r.onsuccess=function(){console.debug('getItemsSaved .index("date").getAll() succeeded'),a(this.result)}}))}},{key:"deleteItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IDBKeyRange.only,n=this.db.transaction(A,"readwrite"),s=n.objectStore(A);return this.getItemsWithDate(e.date,t,n).then((function(n){return new Promise((function(a,i){console.debug("deleteItem: getItemsWithDate succeeded");var r=!1,c=function(e){console.debug("deleteItem add/update failed"),i(e.target?e.target.errorCode:"unknown")},o=function(){console.debug("deleteItem: add/update succeeded."),a(void 0)};n.forEach((function(n){if(!r&&n.name===e.name&&n.saved===e.saved){console.debug("deleteItem: found a matching item, deleting it...");var a=s.delete(t(n.id));a.onerror=c,a.onsuccess=o,r=!0}})),r||(console.debug("warning: deleteItem no matching entry."),a(void 0))}))})).catch((function(e){return console.debug("deleteItem: getItemsWithDate() failed"),Promise.reject("shopping-list-store getItemsWithDate: reason "+e)}))}},{key:"clearAll",value:function(){var e=this;return new Promise((function(t,n){var s=e.db.transaction(A,"readwrite").objectStore(A).clear();s.onerror=function(e){console.debug("clearAll: clear() failed"),n(e.target?e.target.errorCode:"unknown")},s.onsuccess=function(){console.debug("clearAll: clear() succeeded"),t(this.result)}}))}},{key:"clearUnsaved",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:IDBKeyRange.only,n=this.db.transaction(A,"readwrite"),s=n.objectStore(A);return new Promise((function(a,i){n.onerror=function(e){console.debug("clearUnsaved: clear() failed"),i(e.target?e.target.errorCode:"unknown")},n.oncomplete=function(){console.debug("clearUnsaved: clear() succeeded"),a(void 0)},e.getItemsSaved(0,t,n).then((function(e){e.forEach((function(e){s.delete(t(e.id))}))}))}))}},{key:"addUpdateItem",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IDBKeyRange.only,n=this.db.transaction(A,"readwrite"),s=n.objectStore(A);return this.getItemsWithDate(e.date,t,n).then((function(t){return new Promise((function(n,a){console.debug("addUpdateItem: getItemsWithDate succeeded");var i=!1,r=function(e){console.debug("addUpdateItem add/update failed"),a(e.target?e.target.errorCode:"unknown")},c=function(){console.debug("addUpdateItem: add/update succeeded."),n(this.result)};if(t.forEach((function(t){if(!i&&t.name===e.name){console.debug("addUpdateItem: found a matching item, updating it...");var n=N(e);n.id=t.id;var a=s.put(n);a.onerror=r,a.onsuccess=c,i=!0}})),!i){console.debug("addUpdateItem no matching entry yet");var o=s.add(e);return o.onerror=r,void(o.onsuccess=c)}}))})).catch((function(e){return console.debug("addUpdateItem: getItemsWithDate() failed"),Promise.reject("shopping-list-store getItemsWithDate: reason "+e)}))}},{key:"saveUnsaved",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:IDBKeyRange.only,s=this.db.transaction(A,"readwrite"),a=s.objectStore(A);return new Promise((function(i,r){s.onerror=function(e){console.debug("saveUnsaved: transaction failed"),r(e.target?e.target.errorCode:"unknown")},s.oncomplete=function(){console.debug("saveUnsaved: transaction succeeded"),i(void 0)},t.getItemsSaved(0,n,s).then((function(t){t.forEach((function(t){var n=N(t);n.date=e,n.saved=1,a.put(n)})),t.forEach((function(e){a.delete(n(e.id))}))}))}))}}]),e}(),L=new v;(function(e){return arguments.length>1&&void 0!==arguments[1]&&arguments[1]&&(console.debug=function(){}),new Promise((function(t,n){console.debug("Opening DB: "+C);var s=e.open(C,3);s.onsuccess=function(){console.debug("Opened DB: "+C),t(new D(this.result))},s.onerror=function(e){n(e.target?e.target.errorCode:"unknown")},s.onupgradeneeded=function(e){if(console.debug("openDb.onupgradeneeded : "+C),!e||!e.currentTarget||!e.currentTarget.result)return console.debug("openDb.onupgradeneeded : "+C+" no new db in event!"),void n("onupgradeneeded: no new db!");var t=e.currentTarget.result,s=e.target.transaction;if(t.objectStoreNames.contains(A)){var a=s.objectStore(A);a.indexNames.contains("saved")||a.createIndex("saved","saved",{unique:!1})}else{var i=t.createObjectStore(A,{keyPath:"id",autoIncrement:!0});i.createIndex("date","date",{unique:!1}),i.createIndex("saved","saved",{unique:!1})}},s.onblocked=function(){console.debug("openDb.onupgradeneeded : "+C+" blocked on other tabs"),n("openDb upgrade: close other tabs and try again.")}}))})(indexedDB).then((function(e){L.setDB(e),L.fetch()}));var U=function(){var e=Object(s.useState)(new Set([])),t=Object(o.a)(e,2),n=t[0],a=t[1],i=Object(s.useState)(!1),r=Object(o.a)(i,2),u=r[0],m=r[1],b=Object(s.useState)([]),v=Object(o.a)(b,2),f=v[0],g=v[1],p=Object(s.useState)([]),O=Object(o.a)(p,2),x=O[0],w=O[1],S=Object(s.useState)(new Map),N=Object(o.a)(S,2),C=N[0],A=N[1],D=Object(s.useState)(""),U=Object(o.a)(D,2),E=U[0],q=U[1],P=Object(s.useState)(0),B=Object(o.a)(P,2),M=B[0],T=B[1],R=Object(s.useState)(""),W=Object(o.a)(R,2),F=W[0],K=W[1],Q=Object(s.useState)(""),G=Object(o.a)(Q,2),z=G[0],J=G[1],H=Object(s.useState)(new Date),Y=Object(o.a)(H,2),V=Y[0],X=Y[1],Z=Object(s.useState)(!1),$=Object(o.a)(Z,2),_=$[0],ee=$[1],te=Object(s.useState)(!1),ne=Object(o.a)(te,2),se=ne[0],ae=ne[1],ie={name:E,setName:q,quantity:M,setQuantity:T,unit:F,setUnit:K,comment:z,setComment:J,existing:_,setExisting:ee,date:V,setDate:X};return Object(s.useEffect)((function(){if(se||!n.size&&!u){L.hasDB()&&L.fetch();var e=function(e){se&&ae(!1),m(0===e.length),a(new Set(e.map((function(e){return e.name}))));var t=new Map,n=[],s=new Map;e.forEach((function(e){e.saved||n.push(e);var a=t.get(e.name);if(a?a.date<e.date&&t.set(e.name,e):t.set(e.name,e),e.saved){var i=s.get(e.date.valueOf());i?i.push(e):s.set(e.date.valueOf(),[e])}})),g(Object(c.a)(t.values())),w(n),n.length&&X(n[0].date),A(s)};return L.addListener(e),function(){L.removeListener(e)}}})),Object(h.jsx)(d.a,{children:Object(h.jsxs)("div",{children:[Object(h.jsx)("nav",{children:Object(h.jsxs)("ul",{className:"nav",children:[Object(h.jsx)("li",{className:"nav-item",children:Object(h.jsx)(d.b,{to:"/",className:"nav-link",children:"New list"})}),Object(h.jsx)("li",{className:"nav-item",children:Object(h.jsx)(d.b,{to:"/previous",className:"nav-link",children:"Previous lists"})}),Object(h.jsx)("li",{className:"nav-item",children:Object(h.jsx)(d.b,{to:"/userdata",className:"nav-link",children:"User data"})})]})}),Object(h.jsx)(j,{value:L,children:Object(h.jsxs)(l.c,{children:[Object(h.jsx)(l.a,{path:"/userdata",children:Object(h.jsx)(k,{})}),Object(h.jsx)(l.a,{path:"/previous",children:Object(h.jsx)(I,{dateMap:C})}),Object(h.jsx)(l.a,{path:"/",children:Object(h.jsx)(y,{masterList:n,setMasterList:a,newList:x,setNewList:w,masterItems:f,newItemStatesAndSetters:ie,runFetchEffect:se,setRunFetchEffect:ae})})]})})]})})};r.a.render(Object(h.jsx)(a.a.StrictMode,{children:Object(h.jsx)(U,{})}),document.getElementById("root"))}},[[41,1,2]]]);
//# sourceMappingURL=main.dea9d577.chunk.js.map