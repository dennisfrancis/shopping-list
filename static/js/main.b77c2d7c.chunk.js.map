{"version":3,"sources":["consts/itemConsts.ts","contexts/storage.ts","components/ItemControls.tsx","components/ItemDisplay.tsx","components/ItemList.tsx","pages/NewList.tsx","components/ListDisplay.tsx","pages/PreviousLists.tsx","pages/Settings.tsx","types/item.ts","storage/storageDefs.ts","App.tsx","index.tsx"],"names":["Units","Set","StorageType","db","undefined","listeners","this","invokeListeners","bind","items","forEach","listener","getAllItems","then","add","delete","item","addUpdateItem","deleteItem","clearUnsaved","saveDate","saveUnsaved","exportToJSON","obj","JSON","stringify","StorageContext","React","createContext","StorageProvider","Provider","ItemControls","props","storage","useContext","newItemStatesAndSetters","newItemName","name","setNewItemName","setName","quantity","setQuantity","unit","setUnit","comment","setComment","existing","setExisting","date","nextList","masterList","masterItem","newList","find","push","id","className","htmlFor","type","list","aria-label","onChange","e","currentTarget","value","masterItems","findIndex","required","map","min","parseInt","style","display","flexDirection","justifyContent","onClick","preventDefault","addUpdate","saved","setNewList","currList","matchItemIndex","listCopy","matchItem","setMasterList","currentSet","has","newSet","flexGrow","ItemDisplay","selected","width","removeItem","itemListToText","message","window","localStorage","getItem","itemsText","toLocaleDateString","length","index","commentString","join","ItemList","useState","copied","setCopied","maxHeight","overflowY","copyList","navigator","clipboard","writeText","setTimeout","NewItemList","clearNewItemControls","marginTop","Date","setRunFetchEffect","disabled","NewList","nameToRemove","filter","oldItem","ListDisplay","setSelectedDate","toLocaleString","readOnly","PreviousLists","selectedDate","dateList","dateMap","keys","sort","date1","date2","valueOf","selectedItems","get","marginLeft","size","Settings","setMessage","placeholder","setItem","exportToJSONText","text","a","document","createElement","file","Blob","href","URL","createObjectURL","download","click","cloneItem","getItemFromObject","DB_NAME","DB_SHOPPING_LIST_STORE_NAME","ShoppingDatabase","maxCount","Promise","resolve","reject","getReq","transaction","objectStore","getAll","onerror","event","console","debug","target","errorCode","onsuccess","result","keyRangeOnly","IDBKeyRange","only","getItemsWithDate","found","setReq","catch","reason","request","clear","oncomplete","getItemsSaved","clearItem","prevItem","itemClone","put","unSavedItem","newItem","jsonString","parse","Array","isArray","itemObj","repr","clearAll","i","storageDb","openDbReq","open","onupgradeneeded","tx","objectStoreNames","contains","listStore","indexNames","createIndex","unique","createObjectStore","keyPath","autoIncrement","onblocked","openDb","indexedDB","setDB","fetch","App","dbIsEmpty","setDBIsEmpty","setMasterItems","Map","setDateMap","setDate","runFetchEffect","itemStatesAndSetters","useEffect","hasDB","dbListener","mList","nameToItem","currentList","dateMapTemp","set","dateItemList","values","addListener","removeListener","to","path","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.b77c2d7c.chunk.js","sourcesContent":["export const Units = new Set([\n    'Kg',\n    'gm',\n    'Packet(s)',\n    'No'\n]);","import React from 'react'\nimport { Item } from '../types/item';\nimport { ShoppingDatabase } from '../storage/storageDefs';\n\nexport class StorageType {\n    private db: ShoppingDatabase | undefined = undefined;\n    private listeners = new Set<((x: Item[]) => void)>();\n    constructor(db?: ShoppingDatabase) {\n        this.db = db;\n        this.invokeListeners = this.invokeListeners.bind(this);\n    }\n\n    public setDB(db: ShoppingDatabase) {\n        this.db = db;\n    }\n\n    public hasDB(): boolean {\n        return !!this.db;\n    }\n\n    private invokeListeners(items: Item[]) {\n        // console.log('Invoking ' + this.masterListeners.size + ' master listeners.');\n        this.listeners.forEach((listener) => {\n            listener(items);\n        });\n    }\n\n    public fetch() {\n        if (!this.db)\n            return;\n\n        this.db.getAllItems().then(this.invokeListeners);\n    }\n\n    public addListener(listener: (x: Item[]) => void) {\n        this.listeners.add(listener);\n    }\n\n    public removeListener(listener: (x: Item[]) => void) {\n        this.listeners.delete(listener);\n    }\n\n    public addUpdate(item: Item) {\n        if (!this.db)\n            return;\n\n        this.db.addUpdateItem(item);\n    }\n\n    public delete(item: Item) {\n        if (!this.db)\n            return;\n\n        this.db.deleteItem(item);\n    }\n\n    public clearUnsaved() {\n        if (!this.db)\n            return;\n\n        return this.db.clearUnsaved();\n    }\n\n    public saveUnsaved(saveDate: Date) {\n        if (!this.db)\n            return;\n\n        return this.db.saveUnsaved(saveDate);\n    }\n\n    public async exportToJSONText() {\n        let obj;\n        try {\n            obj = await this.db?.exportToJSON();\n        } catch (e) {\n            return '';\n        }\n\n        return JSON.stringify(obj);\n    }\n};\n\nexport const StorageContext = React.createContext({} as StorageType);\nexport const StorageProvider = StorageContext.Provider;","import React from \"react\";\nimport { useContext } from \"react\";\nimport { Units } from \"../consts/itemConsts\";\nimport { StorageContext } from \"../contexts/storage\";\nimport { Item, ItemStatesAndSetters } from '../types/item';\n\nimport '../styles/itemcontrols.css';\n\ntype ItemControlProps = {\n    masterList: Set<string>;\n    masterItems: Item[];\n    setMasterList: React.Dispatch<React.SetStateAction<Set<string>>>;\n    newList: Item[];\n    setNewList: React.Dispatch<React.SetStateAction<Item[]>>;\n    newItemStatesAndSetters: ItemStatesAndSetters;\n};\n\nexport function ItemControls(props: ItemControlProps) {\n    const storage = useContext(StorageContext)\n    let {\n        name: newItemName,\n        setName: setNewItemName,\n        quantity,\n        setQuantity,\n        unit,\n        setUnit,\n        comment,\n        setComment,\n        existing,\n        setExisting,\n        date\n    } = props.newItemStatesAndSetters;\n\n    let nextList:string[] = [];\n    props.masterList.forEach(masterItem => {\n        if (!props.newList.find(item => item.name === masterItem))\n            nextList.push(masterItem);\n    });\n\n    function handleNewItem(e: React.FormEvent<HTMLInputElement>) {\n        e.preventDefault();\n\n        if (!newItemName || !quantity || !unit)\n            return;\n\n        storage.addUpdate({name: newItemName, quantity, unit, comment, saved: 0, date});\n        props.setNewList(currList => {\n            let matchItemIndex = currList.findIndex((item) => item.name === newItemName);\n            if (matchItemIndex === -1) {\n                return [...currList, {name: newItemName, quantity, unit, comment, saved: 0, date}];\n            }\n\n            let listCopy = [...currList];\n            let matchItem = listCopy[matchItemIndex];\n            matchItem.quantity = quantity;\n            matchItem.unit = unit;\n            matchItem.comment = comment;\n            return listCopy;\n        });\n\n        props.setMasterList(currentSet => {\n            if (currentSet.has(newItemName))\n                return currentSet;\n            let newSet = new Set<string>(currentSet);\n            newSet.add(newItemName);\n            return newSet;\n        });\n        setNewItemName('');\n        setQuantity(0);\n        setUnit('');\n        setComment('');\n        setExisting(false);\n    }\n\n    function handleItemNameChange(e: React.FormEvent<HTMLInputElement>) {\n        setNewItemName(e.currentTarget.value);\n        let masterItem = props.masterItems.find((item) => item.name === e.currentTarget.value);\n        if (masterItem) {\n            setQuantity(masterItem.quantity);\n            setUnit(masterItem.unit);\n            setUnit(masterItem.unit);\n            setComment(masterItem.comment);\n        }\n        setExisting(props.newList.findIndex((item) => item.name === e.currentTarget.value) !== -1);\n    }\n\n    function handleQtyChange(e: React.FormEvent<HTMLInputElement>) {\n        if (e.currentTarget.value === '') {\n            setQuantity(0);\n            return;\n        }\n        setQuantity(parseInt(e.currentTarget.value));\n    }\n\n    function handleUnitChange(e: React.FormEvent<HTMLInputElement>) {\n        setUnit(e.currentTarget.value);\n    }\n\n    function handleCommentsChange(e: React.FormEvent<HTMLInputElement>) {\n        setComment(e.currentTarget.value);\n    }\n\n    function handleClear() {\n        setNewItemName('');\n        setQuantity(0);\n        setUnit('');\n        setComment('');\n        setExisting(false);\n    }\n\n    return (\n        <form id=\"item-controls\">\n            <div className=\"mb-3\">\n                <label htmlFor=\"item-search\" className=\"form-label\">Item name</label>\n                <input type=\"search\" id=\"item-search\" className=\"form-control bottom-border-only\"\n                    list=\"next-item-list\"\n                    aria-label=\"Search through master list\"\n                    onChange={handleItemNameChange}\n                    value={newItemName}\n                    required></input>\n            </div>\n\n            <datalist id=\"next-item-list\">\n                {nextList.map(item => <option key={item} value={item}/>)}\n            </datalist>\n\n            <div className=\"mb-3\">\n                <label htmlFor=\"qty-input\" className=\"form-label\">Quantity</label>\n                <input type=\"number\" className=\"form-control bottom-border-only\"\n                    id=\"qty-input\"\n                    aria-label=\"Quantity\"\n                    min={1}\n                    required\n                    onChange={handleQtyChange}\n                    value={quantity === 0 ? '' : (quantity + '')}></input>\n            </div>\n\n            <div className=\"mb-3\">\n                <label htmlFor=\"unit-input\" className=\"form-label\">Unit</label>\n                <input type=\"text\" className=\"form-control bottom-border-only\"\n                    id=\"unit-input\"\n                    list=\"unit-list\"\n                    aria-label=\"Unit\"\n                    required\n                    onChange={handleUnitChange}\n                    value={unit}></input>\n            </div>\n\n            <datalist id=\"unit-list\">\n                {[...Units].map(unit => <option key={unit} value={unit}/>)}\n            </datalist>\n\n            <div className=\"mb-3\">\n                <label htmlFor=\"comments-input\" className=\"form-label\">Comments</label>\n                <input type=\"text\" className=\"form-control bottom-border-only\"\n                    id=\"comments-input\"\n                    aria-label=\"Comments\"\n                    onChange={handleCommentsChange}\n                    value={comment}></input>\n            </div>\n            <br></br>\n            <div style={{display: \"flex\", flexDirection: \"row\", justifyContent: \"space-between\"}}>\n                <input type=\"submit\" value={existing ? \"Modify\" : \"Add\"} className=\"btn btn-primary\"\n                    onClick={handleNewItem} style={{flexGrow: 0.40}}></input>\n                <input type=\"button\" value=\"Clear\" className=\"btn btn-danger\"\n                    onClick={handleClear} style={{flexGrow: 0.40}}></input>\n            </div>\n        </form>\n    );\n};\n","import React from 'react';\nimport { Item, ItemStatesAndSetters } from \"../types/item\";\n\nexport function ItemDisplay(props: {\n    item: Item,\n    newItemStatesAndSetters?: ItemStatesAndSetters,\n    removeItem?: (x: Item) => void\n}) {\n    const handleItemClick = () => {\n        if (!props.newItemStatesAndSetters)\n            return;\n\n        props.newItemStatesAndSetters.setName(props.item.name);\n        props.newItemStatesAndSetters.setQuantity(props.item.quantity);\n        props.newItemStatesAndSetters.setUnit(props.item.unit);\n        props.newItemStatesAndSetters.setComment(props.item.comment);\n        props.newItemStatesAndSetters.setExisting(true);\n    };\n\n    let selected = props.newItemStatesAndSetters ? (props.newItemStatesAndSetters.name === props.item.name) : false;\n    const removeItem = () => {\n        if (props.removeItem)\n            props.removeItem(props.item);\n    };\n    return (\n        <li className={\"list-group-item d-flex justify-content-between align-items-start\" + (selected ? \" active\" : \"\")}>\n            <div className=\"ms-2 me-auto\" style={{width: \"100vw\"}} onClick={handleItemClick}>\n                <div className=\"fw-bold\" style={{display: \"inline\"}}>{props.item.name + (props.item.comment ? ' (' + props.item.comment + ')' : '')}</div>\n                <div>{props.item.quantity}&nbsp;{props.item.unit}</div>\n            </div>\n            {props.removeItem && <button type=\"button\" className=\"btn-close\" aria-label=\"Close\" onClick={removeItem}></button>}\n        </li>\n    );\n}","import { useContext, useState } from \"react\";\nimport { Item, ItemStatesAndSetters } from '../types/item';\nimport { ItemDisplay } from '../components/ItemDisplay';\nimport { StorageContext } from '../contexts/storage';\n\nimport '../styles/newitemlist.css';\n\nconst itemListToText = (list: Item[]): string => {\n    let message = window.localStorage.getItem('settings_message');\n    let itemsText: string[] = !message ? [`${list[0].date.toLocaleDateString()}`, `${list.length} items`, ''] :\n        [message, ''];\n    list.forEach((item, index) => {\n        let commentString = item.comment ? ` (${item.comment})` : '';\n        itemsText.push(`${index + 1}. ${item.name}${commentString} : ${item.quantity} ${item.unit}`);\n    });\n\n    return itemsText.join('\\n');\n}\n\nexport function ItemList(props: {\n    list: Item[],\n    copyList?: boolean,\n    removeItem?: ((x: Item) => void),\n    newItemStatesAndSetters?: ItemStatesAndSetters\n}) {\n\n    let [copied, setCopied] = useState(false);\n\n    const handleCopy = () => {\n        navigator.clipboard.writeText(itemListToText(props.list))\n            .then(() => {\n                setCopied(true);\n                setTimeout(() => {\n                    setCopied(false);\n                }, 1000);\n            });\n    };\n\n    return (\n        <div>\n            <ol className=\"list-group list-group-numbered\" style={{maxHeight: \"80vh\", overflowY:\"auto\"}}>\n                {props.list.map(item =>\n                    <ItemDisplay item={item} key={item.name}\n                        newItemStatesAndSetters={props.newItemStatesAndSetters}\n                        removeItem={props.removeItem}/>)}\n            </ol>\n            <br/>\n            {\n                props.copyList && props.list.length > 0 &&\n                <input type=\"button\" value={copied ? 'Copied!' : 'Copy list'} className={\"btn \" + (copied ? \"btn-success\" : \"btn-primary\")}\n                    onClick={handleCopy}/>\n            }\n        </div>\n    );\n}\n\nexport function NewItemList(props: {\n    list: Item[],\n    removeItem: (x: Item) => void,\n    newItemStatesAndSetters: ItemStatesAndSetters,\n    setRunFetchEffect: (flag: boolean) => void\n}) {\n    const storage = useContext(StorageContext);\n\n    const clearNewItemControls = () => {\n        props.newItemStatesAndSetters.setName('');\n        props.newItemStatesAndSetters.setQuantity(0);\n        props.newItemStatesAndSetters.setUnit('');\n        props.newItemStatesAndSetters.setComment('');\n        props.newItemStatesAndSetters.setExisting(false);\n    };\n\n    const handleClear = () => {\n        if (props.list.length === 0)\n            return;\n\n        storage.clearUnsaved()?.then(() => {\n            clearNewItemControls();\n            props.setRunFetchEffect(true);\n        })\n    };\n\n    const handleSave = () => {\n        if (props.list.length === 0)\n            return;\n\n        const saveDate = new Date();\n        storage.saveUnsaved(saveDate)?.then(() => {\n            clearNewItemControls();\n            props.setRunFetchEffect(true);\n        });\n\n        navigator.clipboard.writeText(itemListToText(props.list));\n    };\n\n    return (\n        <div id=\"new-item-list-wrapper\">\n            <p>Shopping list({props.list.length})</p>\n            <ItemList list={props.list} newItemStatesAndSetters={props.newItemStatesAndSetters}\n                removeItem={props.removeItem}/>\n            <div style={{display: \"flex\", flexDirection: \"row\", justifyContent: \"space-between\", marginTop: 10}}>\n                <input type=\"button\" value=\"Save and Copy\" className=\"btn btn-primary\"\n                    onClick={handleSave} style={{flexGrow: 0.40}} disabled={props.list.length === 0}></input>\n                <input type=\"button\" value=\"Clear\" className=\"btn btn-danger\"\n                    onClick={handleClear} style={{flexGrow: 0.40}} disabled={props.list.length === 0}></input>\n            </div>\n        </div>\n    );\n}","import React from \"react\";\nimport { Item, ItemStatesAndSetters } from '../types/item';\nimport { ItemControls } from \"../components/ItemControls\";\nimport { DebugItemLists } from \"../components/DebugItemLists\";\nimport { NewItemList } from '../components/ItemList';\nimport { useContext } from \"react\";\nimport { StorageContext } from \"../contexts/storage\";\n\nimport \"../styles/newlist.css\";\n\nexport function NewList(props: {\n    masterList: Set<string>;\n    masterItems: Item[];\n    setMasterList: React.Dispatch<React.SetStateAction<Set<string>>>;\n    newList: Item[];\n    setNewList: React.Dispatch<React.SetStateAction<Item[]>>;\n    newItemStatesAndSetters: ItemStatesAndSetters;\n    runFetchEffect: boolean;\n    setRunFetchEffect: React.Dispatch<React.SetStateAction<boolean>>;\n}) {\n    const storage = useContext(StorageContext);\n    let {\n        name,\n        setName,\n        setQuantity,\n        setUnit,\n        setComment,\n        setExisting\n    } = props.newItemStatesAndSetters;\n\n    const removeItem = (item: Item) => {\n        const nameToRemove = item.name;\n        const list = props.newList.filter(oldItem => oldItem.name !== nameToRemove);\n        storage.delete(item);\n        props.setNewList(list);\n        if (name === nameToRemove) {\n            setName('');\n            setQuantity(0);\n            setUnit('');\n            setComment('');\n            setExisting(false);\n        }\n    };\n\n    let debugMode = false;\n\n    return (\n        <div id=\"newlist-wrapper\">\n            <ItemControls masterList={props.masterList} setMasterList={props.setMasterList}\n                newList={props.newList} setNewList={props.setNewList}\n                masterItems={props.masterItems} newItemStatesAndSetters={props.newItemStatesAndSetters}/>\n            <NewItemList list={props.newList} newItemStatesAndSetters={props.newItemStatesAndSetters}\n                removeItem={removeItem} setRunFetchEffect={props.setRunFetchEffect}/>\n            {debugMode && <DebugItemLists masterList={props.masterList} newList={props.newList} />}\n        </div>\n    );\n}\n","import React from \"react\";\nimport { Item } from '../types/item';\n\nexport function ListDisplay(props: {\n    date: number,\n    items: Item[],\n    selected: boolean;\n    setSelectedDate: React.Dispatch<React.SetStateAction<number>>;\n    readOnly: boolean;\n}) {\n    const handleListClick = () => {\n        props.setSelectedDate(props.date);\n    };\n\n    const removeList = () => {\n        // TODO: remove from items from db and re-fetch.\n    };\n\n    return (\n        <li className={\"list-group-item d-flex justify-content-between align-items-start\" + (props.selected ? \" active\" : \"\")}>\n            <div className=\"ms-2 me-auto\" style={{width: \"100vw\"}} onClick={handleListClick}>\n                <div className=\"fw-bold\" style={{display: \"inline\"}}>{new Date(props.date).toLocaleString()}</div>\n                <div>{props.items.length}&nbsp;items</div>\n            </div>\n            {!props.readOnly && <button type=\"button\" className=\"btn-close\" aria-label=\"Close\" onClick={removeList}></button> }\n        </li>\n    );\n}","import React from \"react\";\nimport { Item } from '../types/item';\nimport { ListDisplay  } from \"../components/ListDisplay\";\nimport { ItemList } from \"../components/ItemList\";\nimport { useState } from \"react\";\n\nimport \"../styles/previouslists.css\";\n\nexport function PreviousLists(props: {\n    dateMap: Map<number, Item[]>;\n}) {\n    let [selectedDate, setSelectedDate] = useState<number>(0);\n    const dateList = [...props.dateMap.keys()].sort((date1, date2) => date2.valueOf() - date1.valueOf());\n    const selectedItems = props.dateMap.get(selectedDate);\n    return (\n        <div style={{marginLeft: 10, width: \"90%\"}}>\n            <p>Previous shopping lists({props.dateMap.size})</p>\n            <div id=\"previous-lists-wrapper\">\n                <div>\n                    <ol id=\"previous-lists\" className=\"list-group list-group-numbered\">\n                        { dateList.map(date =>\n                            <ListDisplay date={date} items={props.dateMap.get(date) || []}\n                                key={date} selected={date === selectedDate} setSelectedDate={setSelectedDate} readOnly={true}/> )}\n                    </ol>\n                </div>\n                <div id=\"previous-list-one\">\n                    { (selectedDate !== 0 && selectedItems !== undefined) && <ItemList list={selectedItems} copyList={true}/> }\n                </div>\n            </div>\n        </div>\n    );\n}","import { useContext, useState } from \"react\";\nimport { StorageContext } from \"../contexts/storage\";\n\nimport '../styles/settings.css'\n\nfunction Settings() {\n    let [name, setName] = useState(window.localStorage.getItem('settings_name'));\n    let [message, setMessage] = useState(window.localStorage.getItem('settings_message'));\n    const storage = useContext(StorageContext);\n\n    function handleNameChange(e: React.FormEvent<HTMLInputElement>) {\n        setName(e.currentTarget.value)\n    }\n\n    function handleMessageChange(e: React.FormEvent<HTMLTextAreaElement>) {\n        setMessage(e.currentTarget.value);\n    }\n\n    function handleSave() {\n        if (name) {\n            window.localStorage.setItem('settings_name', name);\n        }\n\n        if (message) {\n            window.localStorage.setItem('settings_message', message);\n        }\n    }\n\n    function handleClear() {\n        window.localStorage.removeItem('settings_name');\n        window.localStorage.removeItem('settings_message');\n        setName('');\n        setMessage('');\n    }\n\n    function handleExport() {\n        storage.exportToJSONText().then(function (text) {\n            let a = document.createElement(\"a\");\n            let file = new Blob([text], {type: 'text/plain'});\n            a.href = URL.createObjectURL(file);\n            a.download = 'shopping-list-export-' + (new Date()).toLocaleDateString() + '.json';\n            a.click();\n        });\n    }\n\n    return (\n        <form id=\"settings-form\">\n            <div className=\"mb-3\">\n                <label htmlFor=\"settings-name\" className=\"form-label\">Name</label>\n                <input type=\"text\" id=\"settings-name\" className=\"form-control\"\n                    aria-label=\"Your name\"\n                    placeholder=\"Your name\"\n                    onChange={handleNameChange}\n                    value={name ? name : ''}>\n                </input>\n            </div>\n            <div className=\"mb-3\">\n                <label htmlFor=\"settings-message\" className=\"form-label\">Custom message for delivery</label>\n                <textarea id=\"settings-message\" className=\"form-control\"\n                    aria-label=\"Your message\"\n                    placeholder=\"Your message\"\n                    onChange={handleMessageChange}\n                    value={message ? message : ''}>\n                </textarea>\n            </div>\n            <br></br>\n            <div style={{display: \"flex\", flexDirection: \"row\", justifyContent: \"space-between\"}}>\n                <input type=\"submit\" value={\"Save\"} className=\"btn btn-primary\"\n                    onClick={handleSave} style={{flexGrow: 0.40}}></input>\n                <input type=\"button\" value=\"Clear\" className=\"btn btn-danger\"\n                    onClick={handleClear} style={{flexGrow: 0.40}}></input>\n            </div>\n            <br></br>\n            <input type=\"button\" value={\"Export\"} className=\"btn btn-primary\"\n                    onClick={handleExport}></input>\n        </form>\n    );\n}\n\nexport default Settings;","export type BooleanNumber = 0 | 1;\n\nexport type Item = {\n    name: string;\n    quantity: number;\n    unit: string;\n    comment: string;\n    date: Date;\n    saved: BooleanNumber;\n};\n\nexport type ItemStatesAndSetters = {\n    name: string;\n    setName: (name: string) => void;\n    quantity: number;\n    setQuantity: (qty: number) => void;\n    unit: string;\n    setUnit: (unit: string) => void;\n    comment: string;\n    setComment: (comment: string) => void;\n    date: Date;\n    setDate: (date: Date) => void;\n    existing: boolean;\n    setExisting: (val: boolean) => void;\n}\n\nexport function cloneItem(item: Item): Item {\n    return {\n        name: item.name,\n        quantity: item.quantity,\n        unit: item.unit,\n        comment: item.comment,\n        date: item.date,\n        saved: item.saved\n    };\n}\n\nexport type JSONRepresentationType = {\n    items: Item[];\n    name: string;\n    message: string;\n}\n\nexport function getItemFromObject(obj: any): Item | undefined {\n    if (typeof obj !== 'object')\n        return undefined;\n\n    if (typeof obj.name !== 'string' ||\n        typeof obj.quantity !== 'number' ||\n        typeof obj.unit !== 'string' ||\n        typeof obj.comment !== 'string' ||\n        typeof obj.date !== 'string' ||\n        typeof obj.saved !== 'number')\n        return undefined;\n\n    return {\n        name: obj.name,\n        quantity: obj.quantity,\n        unit: obj.unit,\n        comment: obj.comment,\n        date: new Date(obj.date),\n        saved: obj.saved,\n    }\n}\n\nexport interface StorageMin {\n    clear(): void;\n    getItem(key: string): string | null;\n    removeItem(key: string): void;\n    setItem(key: string, value: string): void;\n}","import { Item, cloneItem, BooleanNumber, JSONRepresentationType, getItemFromObject, StorageMin } from '../types/item';\n\nconst DB_NAME = 'shopping-list-app-db';\nconst DB_VERSION = 3;\nconst DB_SHOPPING_LIST_STORE_NAME = 'shopping-list-store';\n\nexport class ShoppingDatabase {\n    private db: IDBDatabase;\n    constructor (db: IDBDatabase) {\n        this.db = db;\n    }\n\n    getAllItems(maxCount: number = -1) {\n        return new Promise((resolve: (x: Item[]) => void, reject) => {\n            let objectStore = this.db.transaction(DB_SHOPPING_LIST_STORE_NAME).objectStore(DB_SHOPPING_LIST_STORE_NAME);\n            let getReq = objectStore.getAll(null, maxCount > 0 ? maxCount : undefined);\n            getReq.onerror = function(event: Event) {\n                console.debug('getAllItems getAll() failed');\n                reject(DB_SHOPPING_LIST_STORE_NAME + ' getAll: errCode' +\n                    event && event.target ? (event.target as any).errorCode : 'unknown');\n            };\n\n            getReq.onsuccess = function(this: IDBRequest<any[]>) {\n                console.debug('getAllItems: getAll() succeeded.');\n                resolve(this.result);\n            };\n        });\n    }\n\n    getItemsWithDate(date: Date, keyRangeOnly: (x: any) => IDBKeyRange = IDBKeyRange.only, transaction?: IDBTransaction) {\n        return new Promise((resolve: (items: Item[]) => void, reject) => {\n            let objectStore = (transaction ? transaction : this.db.transaction(DB_SHOPPING_LIST_STORE_NAME))\n                .objectStore(DB_SHOPPING_LIST_STORE_NAME);\n            let getReq = objectStore.index('date').getAll(keyRangeOnly(date));\n\n            getReq.onerror = function(event: Event) {\n                console.debug('getItemsWithDate .index(\"date\").getAll() failed');\n                reject(DB_SHOPPING_LIST_STORE_NAME + ' index(\"date\").getAll: errCode' +\n                    event && event.target ? (event.target as any).errorCode : 'unknown');\n            }\n\n            getReq.onsuccess = function(this: IDBRequest<any[]>) {\n                console.debug('getItemsWithDate .index(\"date\").getAll() succeeded');\n                resolve(this.result);\n            }\n        });\n    }\n\n    getItemsSaved(saved: BooleanNumber, keyRangeOnly: (x: any) => IDBKeyRange = IDBKeyRange.only, transaction?: IDBTransaction) {\n        return new Promise((resolve: (items: Item[]) => void, reject) => {\n            let objectStore = (transaction ? transaction : this.db.transaction(DB_SHOPPING_LIST_STORE_NAME))\n                .objectStore(DB_SHOPPING_LIST_STORE_NAME);\n            let getReq = objectStore.index('saved').getAll(keyRangeOnly(saved));\n\n            getReq.onerror = function(event: Event) {\n                console.debug('getItemsSaved .index(\"date\").getAll() failed');\n                reject(DB_SHOPPING_LIST_STORE_NAME + ' index(\"date\").getAll: errCode' +\n                    event && event.target ? (event.target as any).errorCode : 'unknown');\n            }\n\n            getReq.onsuccess = function(this: IDBRequest<any[]>) {\n                console.debug('getItemsSaved .index(\"date\").getAll() succeeded');\n                resolve(this.result);\n            }\n        });\n    }\n\n    deleteItem(item: Item, keyRangeOnly: (x: any) => IDBKeyRange = IDBKeyRange.only) {\n        const transaction = this.db.transaction(DB_SHOPPING_LIST_STORE_NAME, \"readwrite\");\n        let objectStore = transaction.objectStore(DB_SHOPPING_LIST_STORE_NAME);\n        return this.getItemsWithDate(item.date, keyRangeOnly, transaction).then((items) => {\n            return new Promise((resolve, reject) => {\n                console.debug('deleteItem: getItemsWithDate succeeded');\n                let found = false;\n                const onerror = (event: Event) => {\n                    console.debug('deleteItem add/update failed');\n                    reject(DB_SHOPPING_LIST_STORE_NAME + ' add/update failed: errCode' +\n                        event && event.target ? (event.target as any).errorCode : 'unknown');\n                }\n\n                const onsuccess = function() {\n                    console.debug('deleteItem: add/update succeeded.');\n                    resolve(undefined);\n                }\n\n                items.forEach(function(matchItem: any) {\n                    if (!found && matchItem.name === item.name && matchItem.saved === item.saved) {\n                        console.debug('deleteItem: found a matching item, deleting it...');\n                        let setReq = objectStore.delete(keyRangeOnly(matchItem.id));\n                        setReq.onerror = onerror;\n                        setReq.onsuccess = onsuccess;\n                        found = true;\n                    }\n                });\n\n                if (!found) {\n                    console.debug('warning: deleteItem no matching entry.');\n                    resolve(undefined);\n                }\n            });\n        }).catch((reason: any) => {\n            console.debug('deleteItem: getItemsWithDate() failed');\n            return Promise.reject(DB_SHOPPING_LIST_STORE_NAME + ' getItemsWithDate: reason ' + reason);\n        });;\n    }\n\n    clearAll() {\n        return new Promise((resolve, reject) => {\n            let request = this.db.transaction(DB_SHOPPING_LIST_STORE_NAME, \"readwrite\")\n                .objectStore(DB_SHOPPING_LIST_STORE_NAME).clear();\n            request.onerror = function(event: Event) {\n                console.debug('clearAll: clear() failed');\n                reject(DB_SHOPPING_LIST_STORE_NAME + ' clear: errCode' +\n                    event && event.target ? (event.target as any).errorCode : 'unknown');\n            }\n\n            request.onsuccess = function(this: IDBRequest<undefined>) {\n                console.debug('clearAll: clear() succeeded');\n                resolve(this.result);\n            }\n        });\n    }\n\n    clearUnsaved(keyRangeOnly: (x: any) => IDBKeyRange = IDBKeyRange.only) {\n        const transaction = this.db.transaction(DB_SHOPPING_LIST_STORE_NAME, \"readwrite\");\n        let objectStore = transaction.objectStore(DB_SHOPPING_LIST_STORE_NAME);\n        return new Promise<undefined>((resolve, reject) => {\n            transaction.onerror = (event: Event) => {\n                console.debug('clearUnsaved: clear() failed');\n                reject(DB_SHOPPING_LIST_STORE_NAME + ' clear: errCode' +\n                    event && event.target ? (event.target as any).errorCode : 'unknown');\n            };\n\n            transaction.oncomplete = function() {\n                console.debug('clearUnsaved: clear() succeeded');\n                resolve(undefined);\n            };\n\n            this.getItemsSaved(0, keyRangeOnly, transaction).then((items: Item[]) => {\n                items.forEach(function(clearItem: any) {\n                    objectStore.delete(keyRangeOnly(clearItem.id));\n                });\n            }); // catch is not necessary, it will reject in transaction.onerror().\n        });\n    }\n\n    addUpdateItem(item: Item, keyRangeOnly: (x: any) => IDBKeyRange = IDBKeyRange.only) {\n        const transaction = this.db.transaction(DB_SHOPPING_LIST_STORE_NAME, \"readwrite\");\n        let objectStore = transaction.objectStore(DB_SHOPPING_LIST_STORE_NAME);\n        return this.getItemsWithDate(item.date, keyRangeOnly, transaction).then((items: Item[]) => {\n            return new Promise((resolve, reject) => {\n                console.debug('addUpdateItem: getItemsWithDate succeeded');\n                let found = false;\n                const onerror = (event: Event) => {\n                    console.debug('addUpdateItem add/update failed');\n                    reject(DB_SHOPPING_LIST_STORE_NAME + ' add/update failed: errCode' +\n                        event && event.target ? (event.target as any).errorCode : 'unknown');\n                }\n\n                const onsuccess = function(this: IDBRequest<IDBValidKey>) {\n                    console.debug('addUpdateItem: add/update succeeded.');\n                    resolve(this.result);\n                }\n\n                items.forEach(function(prevItem: any) {\n                    if (!found && prevItem.name === item.name) {\n                        console.debug('addUpdateItem: found a matching item, updating it...');\n                        let itemClone = cloneItem(item) as any;\n                        itemClone.id = prevItem.id;\n                        let setReq = objectStore.put(itemClone);\n                        setReq.onerror = onerror;\n                        setReq.onsuccess = onsuccess;\n                        found = true;\n                    }\n                });\n\n                if (!found) {\n                    console.debug('addUpdateItem no matching entry yet');\n                    let setReq = objectStore.add(item);\n                    setReq.onerror = onerror;\n                    setReq.onsuccess = onsuccess;\n                    return;\n                }\n            });\n        }).catch((reason: any) => {\n            console.debug('addUpdateItem: getItemsWithDate() failed');\n            return Promise.reject(DB_SHOPPING_LIST_STORE_NAME + ' getItemsWithDate: reason ' + reason);\n        });\n    }\n\n    saveUnsaved(date: Date, keyRangeOnly: (x: any) => IDBKeyRange = IDBKeyRange.only) {\n        const transaction = this.db.transaction(DB_SHOPPING_LIST_STORE_NAME, \"readwrite\");\n        let objectStore = transaction.objectStore(DB_SHOPPING_LIST_STORE_NAME);\n        return new Promise<undefined>((resolve, reject) => {\n            transaction.onerror = (event: Event) => {\n                console.debug('saveUnsaved: transaction failed');\n                reject(DB_SHOPPING_LIST_STORE_NAME + ' transaction: errCode' +\n                    event && event.target ? (event.target as any).errorCode : 'unknown');\n            };\n\n            transaction.oncomplete = function() {\n                console.debug('saveUnsaved: transaction succeeded');\n                resolve(undefined);\n            };\n\n            this.getItemsSaved(0, keyRangeOnly, transaction).then((items: Item[]) => {\n                items.forEach(function(unSavedItem: Item) {\n                    const newItem = cloneItem(unSavedItem);\n                    newItem.date = date;\n                    newItem.saved = 1;\n                    objectStore.put(newItem);\n                });\n                items.forEach(function(unSavedItem: any) {\n                    objectStore.delete(keyRangeOnly(unSavedItem.id));\n                });\n            }); // catch is not necessary, it will reject in transaction.onerror().\n        });\n    }\n\n    public async exportToJSON(localStorage: StorageMin = window.localStorage) {\n        try {\n            const items = await this.getAllItems();\n            return {\n                items: items,\n                name: localStorage.getItem('settings_name') || '',\n                message: localStorage.getItem('settings_message') || '',\n            };\n        } catch (e) {\n            return {\n                items: [],\n                name: '',\n                message: '',\n            };\n        }\n    }\n\n    public async importFromJSON(jsonString: string,\n        keyRangeOnly: (x: any) => IDBKeyRange = IDBKeyRange.only,\n        localStorage: StorageMin = window.localStorage) {\n\n        const obj = JSON.parse(jsonString);\n        if (typeof obj !== 'object')\n            return false;\n\n        if (!Array.isArray(obj.items))\n            return false;\n\n        let items: Item[] = [];\n        (obj.items as any[]).forEach(itemObj => {\n            const item = getItemFromObject(itemObj);\n            if (item)\n                items.push(item);\n        });\n\n        const repr: JSONRepresentationType = {\n            items: items,\n            name: typeof obj.name === 'string' ? obj.name : '',\n            message: typeof obj.message === 'string' ? obj.message : '',\n        }\n\n        await this.clearAll();\n        for (let i = 0; i < items.length; ++i) {\n            try {\n                await this.addUpdateItem(items[i], keyRangeOnly);\n            } catch (e) {\n                console.debug('Error adding item : ' + items[i] + ' err = ' + e);\n                return false;\n            }\n        }\n\n        localStorage.setItem('settings_name', repr.name);\n        localStorage.setItem('settings_message', repr.message);\n\n        return true;\n    }\n}\n\nexport const openDb = (storageDb: IDBFactory, beSilent: boolean = false) => {\n    if (beSilent) {\n        console.debug = () => {};\n    }\n    return new Promise(function(resolve: (db: ShoppingDatabase) => any, reject) {\n        console.debug('Opening DB: ' + DB_NAME);\n        var openDbReq = storageDb.open(DB_NAME, DB_VERSION);\n        openDbReq.onsuccess = function(this: IDBRequest<IDBDatabase>) {\n            console.debug('Opened DB: ' + DB_NAME);\n            resolve(new ShoppingDatabase(this.result));\n        };\n        openDbReq.onerror = function(event: Event) {\n            reject('openDb failed errCode: ' +\n                event && event.target ? (event.target as any).errorCode : 'unknown');\n        };\n        openDbReq.onupgradeneeded = function (event: Event) {\n            console.debug(\"openDb.onupgradeneeded : \" + DB_NAME);\n            if (!event || !event.currentTarget || !(event.currentTarget as any).result) {\n                console.debug(\"openDb.onupgradeneeded : \" + DB_NAME + ' no new db in event!');\n                reject('onupgradeneeded: no new db!');\n                return;\n            }\n            const db: IDBDatabase = (event.currentTarget as any).result;\n            const tx: IDBTransaction = (event.target as any).transaction;\n\n            if (!db.objectStoreNames.contains(DB_SHOPPING_LIST_STORE_NAME)) {\n                let listStore = db.createObjectStore(DB_SHOPPING_LIST_STORE_NAME,\n                    { keyPath: 'id', autoIncrement: true});\n                listStore.createIndex('date', 'date', { unique: false });\n                listStore.createIndex('saved', 'saved', { unique: false });\n            } else {\n                let listStore = tx.objectStore(DB_SHOPPING_LIST_STORE_NAME);\n                if(!listStore.indexNames.contains('saved')) {\n                    listStore.createIndex('saved', 'saved', { unique: false });\n                }\n            }\n        };\n        openDbReq.onblocked = function () {\n            console.debug(\"openDb.onupgradeneeded : \" + DB_NAME + ' blocked on other tabs');\n            reject('openDb upgrade: close other tabs and try again.');\n        }\n    });\n}","import React from 'react';\nimport {\n  HashRouter,\n  Switch,\n  Route,\n  Link\n} from \"react-router-dom\";\n\nimport './bootstrap.min.css';\nimport { useState } from \"react\";\nimport { Item, ItemStatesAndSetters } from './types/item';\nimport { useEffect } from \"react\";\n\n\nimport { NewList } from './pages/NewList';\nimport { PreviousLists } from  './pages/PreviousLists';\nimport Settings from './pages/Settings';\nimport { openDb } from './storage/storageDefs';\nimport { StorageType, StorageProvider } from './contexts/storage';\n\nlet storage = new StorageType();\n\n(function() {\n    openDb(indexedDB).then((db) => {\n      storage.setDB(db);\n      storage.fetch();\n    });\n})();\n\nfunction App() {\n  let [masterList, setMasterList] = useState(new Set<string>([]));\n  let [dbIsEmpty, setDBIsEmpty] = useState(false);\n  let [masterItems, setMasterItems] = useState([] as Item[]);\n  let [newList, setNewList] = useState<Item[]>([]);\n  let [dateMap, setDateMap] = useState<Map<number, Item[]>>(new Map<number, Item[]>());\n  let [name, setName] = useState('');\n  let [quantity, setQuantity] = useState(0);\n  let [unit, setUnit] = useState('');\n  let [comment, setComment] = useState('');\n  let [date, setDate] = useState(new Date());\n  let [existing, setExisting] = useState(false);\n  let [runFetchEffect, setRunFetchEffect] = useState(false);\n  let itemStatesAndSetters: ItemStatesAndSetters = {\n      name,\n      setName,\n      quantity,\n      setQuantity,\n      unit,\n      setUnit,\n      comment,\n      setComment,\n      existing,\n      setExisting,\n      date,\n      setDate\n  };\n\n  // fetch initial state from DB.\n  useEffect(() => {\n      if (!runFetchEffect && (masterList.size || dbIsEmpty)) {\n          return;\n      }\n\n      if (storage.hasDB()) {\n          // console.log('Fetching...');\n          storage.fetch();\n      }\n\n      const dbListener = (mList: Item[]) => {\n          if (runFetchEffect)\n              setRunFetchEffect(false);\n          setDBIsEmpty((mList.length === 0));\n          setMasterList(new Set<string>(mList.map(item => item.name)));\n          const nameToItem = new Map<string, Item>();\n          const currentList: Item[] = [];\n          const dateMapTemp = new Map<number, Item[]>();\n          mList.forEach((item) => {\n              if (!item.saved)\n                  currentList.push(item);\n\n              let prevItem = nameToItem.get(item.name);\n              if (!prevItem)\n                  nameToItem.set(item.name, item);\n              else if (prevItem.date < item.date)\n                  nameToItem.set(item.name, item);\n\n              if (item.saved) {\n                const dateItemList = dateMapTemp.get(item.date.valueOf());\n                if (!dateItemList)\n                  dateMapTemp.set(item.date.valueOf(), [item]);\n                else\n                  dateItemList.push(item);\n              }\n          });\n          setMasterItems([...nameToItem.values()]);\n          setNewList(currentList);\n          if (currentList.length) {\n              setDate(currentList[0].date);\n          }\n          setDateMap(dateMapTemp);\n      };\n      storage.addListener(dbListener);\n\n      return function cleanup() {\n          storage.removeListener(dbListener);\n      };\n  });\n\n  return (\n    <HashRouter>\n      <div>\n        <nav>\n          <ul className=\"nav\">\n            <li className=\"nav-item\">\n              <Link to=\"/\" className=\"nav-link\">New list</Link>\n            </li>\n            <li className=\"nav-item\">\n              <Link to=\"/previous\" className=\"nav-link\">Previous lists</Link>\n            </li>\n            <li className=\"nav-item\">\n              <Link to=\"/settings\" className=\"nav-link\">Settings</Link>\n            </li>\n          </ul>\n        </nav>\n\n        <StorageProvider value={storage}>\n          {/* A <Switch> looks through its children <Route>s and\n              renders the first one that matches the current URL. */}\n          <Switch>\n            <Route path=\"/settings\">\n              <Settings />\n            </Route>\n            <Route path=\"/previous\">\n                <PreviousLists dateMap={dateMap}/>\n            </Route>\n            <Route path=\"/\">\n                <NewList masterList={masterList} setMasterList={setMasterList}\n                  newList={newList} setNewList={setNewList}\n                  masterItems={masterItems} newItemStatesAndSetters={itemStatesAndSetters}\n                  runFetchEffect={runFetchEffect} setRunFetchEffect={setRunFetchEffect}/>\n            </Route>\n          </Switch>\n        </StorageProvider>\n      </div>\n    </HashRouter>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}